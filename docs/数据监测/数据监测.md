# 数据监测前端开发文档

广西水质 GIS 平台数据监测模块开发文档

- 代码目录--src/views/DataMonitoring/index.vue

## 一、顶部数据查询参数选择

顶部数据查询参数包括了如下内容：

1. 查询类型
2. 查询城市
3. 查询断面
4. 查询水系
5. 查询开始日期
6. 查询结束日期
7. 查询水期代码

- 所在的 DIV <code style="color:red">"class='type-select'"</code>
- changeTypeSelectNuber(index) 控制 1-4、7 的内容选择与展开

### 1.查询类型(typeSelectData[0])

查询类型为查询后台数据方法的必填字段

- 查询类型在前台直接写死，数据内容较少

### 2.查询城市(typeSelectData[1])

查询城市以查询类型为参数，获取后台数据

```
调用src/api/dataMonitoring.js下的getCityList()去查询后台接口'/dataMonitoring/getCityListOfDataMonitoring' --(rap:数据监测->获取城市列表从监测数据)
```

### 3.查询断面(typeSelectData[2])

查询断面以查询类型、查询城市为参数，获取后台数据

```
调用src/api/dataMonitoring.js下的getSectionList()去查询后台接口'/dataMonitoring/getSectionListOfDataMonitoring' --(rap:数据监测->获取断面名称列表从监测数据)
```

### 4.查询水系(typeSelectData[3])

查询水系以查询类型、查询城市、查询断面为参数，获取后台数据

```
调用src/api/dataMonitoring.js下的getRiverList()去查询后台接口'/dataMonitoring/getRiverListOfDataMonitoring' --(rap:数据监测->获取所属水系列表从监测数据)
```

### 5.开始时间(startDate)

开始时间使用了 element 插件的 el-date-picker，可以选择时间日期

- 时间的格式是 2019-7-19

### 6.结束时间(endDate)

结束时间使用了 element 插件的 el-date-picker，可以选择时间日期

- 时间的格式是 2019-7-19

### 7.水期代码(riverCodeData)

水期代码以查询类型、查询城市、查询断面、查询水系为参数，获取后台数据

```
调用src/api/dataMonitoring.js下的getRiverCodeList()去查询后台接口'/dataMonitoring/getRiverCodeListOfDataMonitoring' --(rap:数据监测->获取水期代码列表从监测数据)
```

## 二、查询、导出、显示图表--按钮

1. 查询按钮
2. 导出按钮
3. 显示图表按钮

- 所在的 DIV <code style="color:red">"class='operation'"</code>

### 1.查询按钮

功能描述：根据顶部数据查询参数，去获取数据库的内容

```
调用src/api/dataMonitoring.js下的getMongoData()去查询后台接口'/dataMonitoring/getMongoDataByMultiCondition' --(rap:数据监测->获取数据根据多个条件)
```

前端存放的内容为：

```
pagingObj: {
  tableNameList: [], // 表头 --后台数据res.data.headList
  tableDataList: [], // 数据内容 --后台数据res.data.bodyList
  tablePageList: { currpage: 1 }, // 分页内容 
  allTableDataList: [], // 所有数据内容，用于导出
  isExport: false // 导出控制
}
// 分页内容
this.pagingObj.tablePageList = {
  total: res.data.totalsize, // --后台数据
  size: res.data.pagesize, // --后台数据
  currpage: res.data.currpage // --后台数据
}
```

### 2.导出按钮

功能描述：导出当前所选择的内容--表格导出成excel格式、图表导出成PNG格式
- 表格导出成excel表格需要获取当前条件下所有的数据，然后一次性导出

```
调用src/api/dataMonitoring.js下的getAllMongoData()去查询后台接口'/dataMonitoring/getMongoAllDataByCondition' --(rap:数据监测->获取mongo所有数据根据条件)
```
前端存放内容：
```
this.pagingObj.allTableDataList = res.data
```
- 注意，导出excel表格需要XLXS插件导出，方法：dataMonitorTable.vue=><code style="color:blue">"exportExcel(allDataList)"</code>

### 3.显示图表按钮

功能描述：切换表格与图表的展示形式
- 控制参数：<code style="color:green">"operationSelect"</code>
在显示图表按钮选中的状态下，导出按钮所导出的内容为PNG格式的echarts展示内容图片

## 三、数据展示模块

数据展示分为：

1. 展示表格内容
2. 展示图表内容

### 1.展示表格内容(el-table)

功能描述：把获取到的数据，使用element-ui中的el-table展示出来
- 所在DIV<code style="color:red">"class='show-data'"</code>
- 数据信息见查询按钮

### 2.展示图表内容(echarts)

功能描述：把获取到的数据，使用echarts展示出来，分为折线图(line)和柱状图(bar)
- 所在DIV<code style="color:red">"class='show-data'"</code>
- 数据信息见查询按钮

# 一张图前端开发文档

广西水质 GIS 平台一张图模块开发文档

- 代码目录--src/views/OnePage/index.vue

## 一、左侧菜单栏

左侧菜单栏包括了如下功能：

1. 左侧菜单栏显隐控制
2. 一键还原一张图初始状态功能
3. 图层搜索功能
4. 饮用水、地表水、其他图层、已选图层选中控制与地图联动效果

### 1.左侧菜单栏显隐控制

菜单栏显隐按钮对左侧菜单栏进行显隐控制

- 根据参数 "showLayer" 控制，div "class='layer-btn'"

### 2.一键还原一张图初始状态功能

一键还原按钮调用了其他部分的还原功能，进行了一次性还原

- 根据方法 "isShowReductionWinCheck" 控制，div "class='layer-btn-right'"

### 3.图层搜索功能

图层搜索根据连续汉字匹配的方式，对饮用水、地表水、其他图层、已选图层的内容进行筛选

- 绑定的数据为 "keyWord" ，div "class='search'"

### 4.饮用水、地表水、其他图层、已选图层选中控制与地图联动效果

根据用户勾选状态，去控制地图加载的数据

- 获取数据的后台接口为 "/oneMap/getMenus" , 前端处理数据的方法为 "getLayer" ，vue 中使用到的数据名称为 "layerData"
- 分为一级内容（饮用水、地表水、其他图层、已选图层）， div "class='layer-item'"
- 二级内容（点击后右边弹出）, div "class='layer-second'",二级内容与一级内容相关
- 已选图层根据当前已选择的图层信息进行展示，数据："checkList"

## 二、右侧菜单栏

右侧菜单栏包括了如下功能：

1. 河流筛选
2. 行政区域定位
3. 流域定位

### 1.河流筛选

河流筛选按钮点击后可以加载 ‘四级’ 河流内容-- 干流、一级河流、二级河流、三级河流

- 功能描述：
  - （1）地图加载默认加载干流数据
  - （2）河流等级为干流等级最大，三级河流等级最小。点击级别小的河流，需要展示等级比它大的河流。
    - 如：点击二级河流，需要加载干流、一级河流、二级河流的内容
  - （3）当点击了当前已选等级的河流时，就相当于取消展示流域内容
- 按钮 div <code style="color:red">"class='river-classification'"</code> , 展开内容 div "class='classification'"
- 数据为 "riverRank" ，根据 riverRank 对象中的 value 字段进行传参控制， type 字段控制选中样式

### 2.行政区域定位

行政区域定位包括两部分：根据字母筛选和根据市域筛选，在选择行政区后，可以定位到地图对应的位置，并隐藏其他内容--改变行政区方法为：获取当前点击行政区 "checkAdministrativeItem(name)" 参数'name'是所选行政区内容，在方法中修改 'checkList2' 的信息，与 GIS 联动修改展示内容

- 按钮的样式为 "class='river-classification'"
- （1）根据字母筛选

```
  获取数据的后台接口为 "oneMap/getAdministrative" , 前端处理数据的方法为 "getAdministrative" ，vue中使用到的数据名称为 "administrativeItem"
```

- 展示 div "class='select-group'" , 控制显隐的参数是 "administrativeType === 'letter'"
- （2）根据市域筛选

```
  获取数据的后台接口为 "oneMap/getAdministrativeListOfCitiesAndCounties" , 前端处理数据的方法为 "getAdministrativeListOfCitiesAndCounties" ，vue中使用到的数据名称为 "administrativeListOfCities"
```

- 展示 div "class='select-group-city'" , 控制显隐的参数是 "administrativeType === 'city'"

### 3.流域定位

流域定位包括两部分：流域地图定位和流域名称模糊搜索功能

- 获取数据的后台接口为 "oneMap/getBasin" , 前端处理数据的方法为 "getBasin" ，vue 中使用到的数据名称为 "showRiverNameList"
- 河流定位的样式： 按钮 div "class='right-item basin'" , 弹框 div "class='right-item-checkbox-group basin'"
- （1）流域地图定位
  - 与行政区定位相似，点击跳转到所选河流，方法为： "checkBasinItem(name)",参数'name'是所选河流内容，在方法中修改 'checkList3' 的信息，与 GIS 联动修改展示内容
- （2）流域名称模糊搜索功能
  - 绑定数据："searchData" , 展示控制："isRiverSearchCheck" , 模糊搜索方法 searchFunction()

## 三、地图模块

地图上实现的交互如下：

1. 主要文件地址
2. 地图图层和要素添加
3. 地图交互效果
4. 右侧工具栏

### 1.主要文件地址

- 主要地图代码文件分三部分
- （1）--src/views/OnePage/components/onePageMap.vue模块中，其中主要定义了当前模块中主要用到的方法。
- （2）--src/map/map2d/mixins/OpenlayersMixin.js中，其中主要定义了初始化地图底图方法，地图上要素样式，地图要素拖拽和测量等方法，**这个是个重要文件，其它页面地图模块都要引入这个文件。**
- （3）接口文件，地图gis相关接口位置在--src/api/gisApi.js。

### 3.地图图层和要素添加

- 地图模块根据index.vue模块传过来的Layer（图层）信息，在地图上加载对应的数据，这个信息可以为图层和要素，图层的话就直接用openlayers的wfs矢量图层直接加载，如果是要素的话，先去根据要素名称查询数据,接口是GisApi.getElementInfoByParams(),具体可看--src/api/gisApi.js，查询出结果后添加到地图上。同时也可进行相对的删除操作。
- 新添加的图层和要素都可以实现地图交互。

### 3.地图交互效果

- 鼠标移入地图要素时，要素会有相应的样式改变，方法是onePageMap.vue中的initMouseStyle()。
- 鼠标点击地图上的河流和行政区域要素时，点击不同要素会去筛选出与这个要素相交的其它要素，例如现阶段点击干流要素会筛选出经过该干流的行政区域，点击行政区域会筛选出经过该行政区域的干流，主要的方法是onePageMap.vue中的addFeaturesClickEvent()。
- 鼠标点击地图上的点要素时，会弹窗展示相应数据，其中水文监测图层还会通过接口去加载相应数据，主要的方法是onePageMap.vue中的addFeaturesClickEvent()。

### 4.右侧工具栏

- 距离量算和面积量算的主要方法写在OpenlayersMixin.js中，方法是initTooltip()。
- 攒点功能为点击地图添加一个图标，并且可以添加图标信息，方法是OpenlayersMixin.js中的initTooltip()。
- 定位功能是输入相应的经纬度坐标，然后实现地图的定位，方法在onePageMap.vue中watch监听方法onePageFun。
- 清除功能为删除之前添加的测量和攒点，方法在onePageMap.vue中watch监听方法onePageFun。
- 地图鼠标右键功能，点击后可取消右侧工具栏的选中状态。
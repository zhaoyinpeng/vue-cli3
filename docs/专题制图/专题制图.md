# 专题制图前端开发文档

广西水质 GIS 平台专题制图模块开发文档

- 代码目录--src/views/ThematicMapping/index.vue

## 一、左侧菜单栏

左侧菜单栏包括了如下功能：

1. 左侧菜单栏显隐控制
2. 添加专题图
3. 专题图搜索功能
4. 专题图与地图联动效果

### 1.左侧菜单栏显隐控制

菜单栏显隐按钮对左侧菜单栏进行显隐控制

- 根据参数 "showLayer" 控制，div "class='layer-btn'"

### 2.添加专题图

一键还原按钮调用了其他部分的还原功能，进行了一次性还原

- 根据方法 "isShowReductionWinCheck" 控制，div "class='layer-btn-right'"

### 3.专题图搜索功能

专题图搜索根据连续汉字匹配的方式，对专题图的内容进行筛选

- 绑定的数据为 "keyWord" ，div "class='search'"

### 4.专题图与地图联动效果

根据用户勾选状态，去控制地图加载的数据

- 获取数据的后台接口为 "/oneMap/getMenus" , 前端处理数据的方法为 "getLayer" ，vue 中使用到的数据名称为 "layerData"
- 分为一级内容（饮用水、地表水、其他图层、已选图层）， div "class='layer-item'"
- 二级内容（点击后右边弹出）, div "class='layer-second'",二级内容与一级内容相关
- 已选图层根据当前已选择的图层信息进行展示，数据："checkList"

## 二、右侧菜单栏

右侧菜单栏包括了如下功能：

1. 添加图层
2. 搜索图层

### 1.添加图层

- 里面实现的效果基本上与一张图添加图层相同。具体可看一张图模块中的实现方法。

### 1.搜索图层

- 搜索根据连续汉字匹配的方式，对图层或者要素的内容进行筛选。


## 三、地图模块

地图上实现的交互如下：

1. 主要文件地址
2. 地图图层和要素添加
3. 地图交互效果
4. 右侧工具栏

### 1.主要文件地址

- 主要地图代码文件分三部分
- （1）--src/views/ThematicMapping/components/ThematicMappingMap.vue模块中，其中主要定义了当前模块中主要用到的方法。
- （2）--src/map/map2d/mixins/OpenlayersMixin.js中，其中主要定义了初始化地图底图方法，地图上要素样式，地图要素拖拽和测量等方法，**这个是个重要文件，其它页面地图模块都要引入这个文件**。
- （3）接口文件，地图gis相关接口位置在--src/api/gisApi.js。

### 2.地图图层和要素添加

- 地图模块根据index.vue模块传过来的thematicMapItemLayerInfo（专题图图层）信息，在地图上加载对应的数据，这个信息可以为图层和要素，图层的话就直接用openlayers的wfs矢量图层直接加载，如果是要素的话，先去根据要素名称查询数据,接口是GisApi.getElementInfoByParams(),具体可看--src/api/gisApi.js，查询出结果后添加到地图上。同时也可进行相对的删除操作。
- 新添加的图层和要素都可以实现地图交互。

### 3.地图交互效果

- 鼠标移入地图要素时，要素会有相应的样式改变，方法是ThematicMappingMap.vue中的initMouseStyle()。
- 鼠标点击地图上的河流和行政区域要素时，**取消了筛选功能**。
- 鼠标点击地图上的点要素时，会弹窗展示相应数据，其中水文监测图层还会通过接口去加载相应数据，主要的方法是ThematicMappingMap.vue中的addFeaturesClickEvent()。

### 4.右侧工具栏

- 标题开关方法在index.vue中
- 图例开关方法会根据此时地图中所有的图层去添加图例，并且支持拖动，方法是ThematicMappingMap.vue中的getAllLayersLegend()。
- 指北针开关方法在index.vue中
- 比例尺开关方法会根据此时地图的等级去计算当前的比例尺，并且支持拖动，方法是ThematicMappingMap.vue中的addScaleLine()。
- 文本框添加方法有两种，一种时带尖的文本框，一种是不带尖的文本框，可不限次数添加到地图中心位置上，并且支持拖动，方法是ThematicMappingMap.vue中的addPopup()。
- 上传图片方法是添加本地的一张图到地图上，可不限次数添加到地图中心位置，并且支持拖动和缩放大小，方法是ThematicMappingMap.vue中的addPopup()。
- 图框开关方法会在地图上方显示类似相框的dom元素，方法是ThematicMappingMap.vue中watch监听的thematicMapFun。
- 场景设置方法会在设置地图的透明度，暂时不支持亮度和饱和度的设置，方法在index.vue中
- 清除方法会清除所有已开启的工具栏的功能和添加在地图上的文本框和图片，方法是ThematicMappingMap.vue中watch监听的thematicMapFun。